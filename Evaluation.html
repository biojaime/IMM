<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluaci√≥n RPG Pixel Art - Team Performance</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'VT323', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ecf0f1;
            padding: 20px;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, .05) 2px, rgba(0, 0, 0, .05) 4px);
            pointer-events: none;
            z-index: 1;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(44, 62, 80, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 4px solid #f39c12;
            position: relative;
            z-index: 2;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            text-align: center;
            color: #f1c40f;
            text-shadow: 3px 3px #000, -1px -1px 0 #e67e22;
            font-family: 'Press Start 2P', cursive;
            font-size: 1.8em;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        h2 {
            color: #3498db;
            text-shadow: 2px 2px #000;
            font-family: 'Press Start 2P', cursive;
            font-size: 1.3em;
            margin: 20px 0;
        }

        .subtitle {
            text-align: center;
            font-size: 1.2em;
            color: #95a5a6;
            margin-bottom: 30px;
            font-style: italic;
        }

        label {
            display: block;
            margin-top: 20px;
            font-weight: bold;
            font-size: 1.3em;
            color: #ecf0f1;
        }

        select,
        input,
        button {
            width: 100%;
            padding: 15px;
            margin-top: 10px;
            border-radius: 10px;
            border: 3px solid #34495e;
            font-size: 1.2em;
            font-family: 'VT323', monospace;
            transition: all 0.3s ease;
        }

        select,
        input {
            background-color: #34495e;
            color: #ecf0f1;
        }

        select:focus,
        input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
        }

        button {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
            border: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .btn-tertiary {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        }

        .btn-back {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .hidden {
            display: none;
        }

        .question-card {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            padding: 20px;
            margin-bottom: 15px;
            border-left: 6px solid #3498db;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .question-card:hover {
            transform: translateX(5px);
            border-left-color: #f39c12;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .question-card label {
            margin-top: 0;
            font-size: 1.2em;
            line-height: 1.5;
        }

        .role-badge {
            display: inline-block;
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.1em;
            margin-bottom: 20px;
            border: 2px solid #1e8449;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .pixel-border {
            border: 5px solid #000;
            box-shadow:
                inset 0 0 0 2px #f39c12,
                0 0 0 2px #000;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .loading-spinner {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 8px solid #34495e;
            border-top: 8px solid #f39c12;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .score-select {
            background: linear-gradient(135deg, #16a085 0%, #138d75 100%);
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .info-box {
            background: rgba(52, 152, 219, 0.2);
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: 1.1em;
        }

        .warning-box {
            background: rgba(230, 126, 34, 0.2);
            border: 2px solid #e67e22;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.2em;
            }

            h2 {
                font-size: 1em;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <div class="container pixel-border">
        <h1>‚öîÔ∏è EVALUACI√ìN RPG ‚öîÔ∏è</h1>
        <p class="subtitle">üéÆ Desarrollo Asistido por IA - Arte y Narrativa Originales üé®</p>

        <!-- PASO 1: Selecci√≥n de Compa√±√≠a -->
        <div id="step-company">
            <div class="info-box">
                üìã <strong>Instrucciones:</strong> Selecciona tu compa√±√≠a de desarrollo de videojuegos para comenzar la
                evaluaci√≥n.
            </div>
            <label>üè¢ Selecciona tu Compa√±√≠a:</label>
            <select id="companySelect" onchange="loadMembers()">
                <option value="">-- Seleccionar Compa√±√≠a --</option>
            </select>
        </div>

        <!-- PASO 2: Identificaci√≥n del Usuario -->
        <div id="step-identity" class="hidden">
            <h2>üë§ ¬øQui√©n eres t√∫?</h2>
            <label>Soy:</label>
            <select id="userSelect" onchange="detectUserRole()">
                <option value="">-- Seleccionar tu nombre --</option>
            </select>
            <p id="myRoleDisplay"
                style="text-align: center; font-style: italic; color: #f39c12; font-size: 1.3em; margin-top: 15px;"></p>

            <div id="action-buttons" class="hidden action-buttons">
                <button onclick="startSelfEval()" class="btn-secondary">üõ°Ô∏è Auto-Evaluaci√≥n</button>
                <button onclick="showTeammates()" class="btn-tertiary">‚öîÔ∏è Evaluar Compa√±ero</button>
            </div>
        </div>

        <!-- PASO 3: Selecci√≥n de Compa√±ero a Evaluar -->
        <div id="step-peer-select" class="hidden">
            <h2>üéØ ¬øA qui√©n evaluar√°s?</h2>
            <label>Selecciona un compa√±ero de equipo:</label>
            <select id="peerSelect">
                <option value="">-- Seleccionar compa√±ero --</option>
            </select>
            <button onclick="startPeerEval()">Comenzar Evaluaci√≥n</button>
            <button onclick="resetApp()" class="btn-back">‚¨ÖÔ∏è Volver</button>
        </div>

        <!-- PASO 4: Formulario de Evaluaci√≥n -->
        <div id="step-form" class="hidden">
            <h2 id="formTitle">Evaluaci√≥n</h2>
            <p id="targetName" class="role-badge"></p>
            <div class="warning-box">
                ‚ö†Ô∏è <strong>Importante:</strong> Responde honestamente. Cada pregunta vale 10 puntos. El puntaje final
                ser√° sobre 100.
            </div>
            <div id="questionsContainer"></div>
            <button onclick="submitEvaluation()">üì§ ENVIAR EVALUACI√ìN</button>
            <button onclick="resetApp()" class="btn-back">‚¨ÖÔ∏è Cancelar</button>
        </div>

        <!-- PASO 5: Cargando -->
        <div id="step-loading" class="hidden">
            <div class="loading-spinner">
                <h2 style="text-align: center;">üíæ Guardando en Google Sheets...</h2>
                <div class="spinner"></div>
                <p style="text-align: center; font-size: 1.2em;">Por favor espera...</p>
            </div>
        </div>
    </div>

    <script>
        // ‚úÖ URL DE TU GOOGLE APPS SCRIPT
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxfvXsMkEHoJEgCmuKlLO6szEEzcoNK1qOacZKnan0jNoc1nul3cSDPsW5ni8RAmhxAyg/exec";

        // BASE DE DATOS DE EQUIPOS
        const database = [
            {
                company: "Ravnsarx",
                game: "Survive 24 hours in elevator",
                members: [
                    { name: "Vanesa Nicole Miguel Moreno", role: "CEO" },
                    { name: "Anah√ç Paez Hern√°dez", role: "Lead Programmer" },
                    { name: "Stella del Pilar Carcamo Guzman", role: "Art Director" },
                    { name: "Rebeka Escalera Islas", role: "Narrative Designer" },
                    { name: "Ximena Hern√°ndez L√≥pez", role: "UI/UX Designer" }
                ]
            },
            {
                company: "Tim_Potato",
                game: "Is this case closed?",
                members: [
                    { name: "Liz Mariel Varela Moreno", role: "CEO" },
                    { name: "Renata Ramos L√≥pez", role: "Lead Programmer" },
                    { name: "Victoria Real Ortega", role: "Art Director" },
                    { name: "Elian Nahil Carro Espinosa", role: "Narrative Designer" },
                    { name: "Roma Sophia Sanchez Rivera", role: "UI/UX Designer" },
                    { name: "Octavio Damian Torres Quesnel", role: "Marketing Director" }
                ]
            },
            {
                company: "Nexonix Games",
                game: "Flee the house",
                members: [
                    { name: "yaron abdiel mora sanchez", role: "CEO" },
                    { name: "Oscar Emiliano Lopez Hern√°ndez", role: "Lead Programmer" },
                    { name: "Ernesto Ram√≠rez Quir√≠z", role: "Art Director" },
                    { name: "Luz Merlos Soriano", role: "Narrative Designer" },
                    { name: "Diego Alonso Flores D√≠as", role: "UI/UX Designer" }
                ]
            },
            {
                company: "Mazegames",
                game: "Paint wars. maze attack",
                members: [
                    { name: "Pamela P√©rez", role: "CEO" },
                    { name: "Maily Garc√≠a Lobaton", role: "Lead Programmer" },
                    { name: "Isabella Noriega Ferrer", role: "Art Director" },
                    { name: "Ximena Guadalupe Guti√©rrez Rodriguez", role: "Narrative Designer" },
                    { name: "Silvana Paola Rojas Espinosa", role: "UI/UX Designer" }
                ]
            },
            {
                company: "Afton Robotics",
                game: "The purple curse",
                members: [
                    { name: "camila babette vazquez ruiz", role: "CEO" },
                    { name: "natalia orozco ramos", role: "Lead Programmer" },
                    { name: "rebeca yinely reyes silva", role: "Art Director" },
                    { name: "julieta michelle Miranda Gonz√°lez", role: "Narrative Designer" },
                    { name: "scarlett Schiaffini Badillo", role: "UI/UX Designer" }
                ]
            },
            {
                company: "M.L.E.B.A",
                game: "Pixel Gun 2D",
                members: [
                    { name: "M√°ximo Su√°rez Zenteno", role: "CEO" },
                    { name: "Enrique Ram√≠rez Quir√≠z", role: "Lead Programmer" },
                    { name: "Andr√©s Trevi√±o Flores", role: "Art Director" },
                    { name: "Luis Antonio Malpica Cisneros", role: "Narrative Designer" },
                    { name: "Brayan Eduardo Diego Hernandez", role: "UI/UX Designer" }
                ]
            },
            {
                company: "Cellsuper",
                game: "Kings of clans",
                members: [
                    { name: "Iker Isaac S√°nchez Cruz", role: "CEO" },
                    { name: "Aldo Santiago Aguilar Cesar", role: "Lead Programmer" },
                    { name: "Edwin Rafael Balbuena M√©ndez", role: "Art Director" },
                    { name: "V√≠ctor Hugo Blanco Herrera", role: "Narrative Designer" },
                    { name: "Luis Fernando V√°zquez", role: "UI/UX Designer" }
                ]
            },
            {
                company: "PAPOI'S",
                game: "Papoi's War",
                members: [
                    { name: "Isabella Nicole P√©rez Calva", role: "CEO" },
                    { name: "Sof√≠a Elizabeth Brito Ort√≠z", role: "Lead Programmer" },
                    { name: "Isabella Guzm√°n Aguilar", role: "Art Director" },
                    { name: "Jennifer Barber Angeles", role: "Narrative Designer" },
                    { name: "Aurora Ib√°√±ez Dorantes", role: "UI/UX Designer" },
                    { name: "Mildred Alonso Gonzalez", role: "Marketing Director" }
                ]
            },
            {
                company: "JINDAM",
                game: "The Glitch House",
                members: [
                    { name: "Ana Sophia Escamilla Z√°rate", role: "CEO" },
                    { name: "Dafne Gonz√°lez Alcantarilla", role: "Lead Programmer" },
                    { name: "Jimena Camargo Cerezo", role: "Art Director" },
                    { name: "Mildred Gonz√°lez Cerda", role: "Narrative Designer" },
                    { name: "Nina L√≥pez Guzm√°n", role: "UI/UX Designer" },
                    { name: "Isabel V√°zquez Tello", role: "Marketing Director" }
                ]
            },
            {
                company: "Vagrant Lore Studios",
                game: "Dragons and eternal shadows",
                members: [
                    { name: "Alejandra Dom√≠nguez Vel√°zquez", role: "CEO" },
                    { name: "Dores Gaetana Hern√°ndez Lozano", role: "Lead Programmer" },
                    { name: "Frida Hern√°ndez Cervantes", role: "Art Director" },
                    { name: "Ximena Medell√≠n Torres", role: "Narrative Designer" },
                    { name: "Lidia Conde S√°nchez", role: "UI/UX Designer" }
                ]
            }
        ];

        let currentCompany = null;
        let currentUser = null;
        let targetUser = null;
        let evalType = "";

        // BANCO DE PREGUNTAS - AUTO-EVALUACI√ìN
        const selfQuestions = [
            "¬øAsist√≠ puntualmente a todas las reuniones de equipo para el desarrollo del RPG?",
            "¬øCumpl√≠ con las entregas de mi rol (assets, c√≥digo, guion) en las fechas establecidas?",
            "¬øMi trabajo (historia/arte) fue original y no copiado directamente de internet o IA sin edici√≥n?",
            "¬øUtilic√© la IA de manera √©tica, us√°ndola como asistente y no para hacer todo mi trabajo?",
            "¬øMantuve una comunicaci√≥n respetuosa y constante con mis compa√±eros?",
            "¬øColabor√© activamente en la resoluci√≥n de problemas (bugs, dise√±o) fuera de mi √°rea espec√≠fica?",
            "¬øAcept√© feedback de mis compa√±eros (especialmente del CEO) para mejorar mi parte del juego?",
            "¬øMantuve mis archivos organizados y accesibles para el resto del equipo?",
            "¬øEntend√≠ y respet√© la visi√≥n general del juego 'Pixel Art' definida por el equipo?",
            "¬øMe esforc√© por aprender herramientas nuevas (Piskel, Tkinter, Python) necesarias para el proyecto?"
        ];

        // PREGUNTAS POR ROL - EVALUACI√ìN DE COMPA√ëEROS
        const roleQuestions = {
            "CEO": [
                "¬øLider√≥ al equipo de manera efectiva y mantuvo el orden?",
                "¬øAsegur√≥ que todos cumplieran con los plazos (deadlines)?",
                "¬øTuvo una comunicaci√≥n clara sobre los objetivos del juego?",
                "¬øResolvi√≥ conflictos internos de manera justa?",
                "¬øPrepar√≥ adecuadamente la presentaci√≥n para el 'Shark Tank'?",
                "¬øMostr√≥ organizaci√≥n en la gesti√≥n de las tareas de cada miembro?",
                "¬øMotiv√≥ al equipo cuando hubo dificultades t√©cnicas?",
                "¬øConoc√≠a el estado actual del proyecto en todo momento?",
                "¬øFoment√≥ un ambiente de trabajo colaborativo?",
                "¬øAsumi√≥ responsabilidad final por el producto entregado?"
            ],
            "Lead Programmer": [
                "¬øEl c√≥digo entregado (Python/Tkinter) funciona correctamente?",
                "¬øLogr√≥ integrar los gr√°ficos y textos en la aplicaci√≥n?",
                "¬øSolucion√≥ los errores (bugs) de manera eficiente?",
                "¬øEl movimiento y las mec√°nicas del juego se sienten fluidas?",
                "¬øExplic√≥ al equipo c√≥mo ejecutar el juego correctamente?",
                "¬øMostr√≥ l√≥gica y orden en la estructura de su programaci√≥n?",
                "¬øColabor√≥ con el UI Designer para implementar los men√∫s?",
                "¬øUtiliz√≥ la IA para corregir c√≥digo sin depender ciegamente de ella?",
                "¬øOptimiz√≥ el juego para que no fuera lento?",
                "¬øEstuvo dispuesto a hacer cambios en el c√≥digo seg√∫n las necesidades de arte/historia?"
            ],
            "Art Director": [
                "¬øEl arte (personajes, fondos) mantiene una est√©tica Pixel Art consistente?",
                "¬øLos dise√±os son originales y creativos (no solo bajados de internet)?",
                "¬øEntreg√≥ los assets (im√°genes) en el formato y tama√±o correcto?",
                "¬øUs√≥ herramientas como Piskel o GIMP de manera efectiva?",
                "¬øLa paleta de colores es agradable y coherente en todo el juego?",
                "¬øDise√±√≥ una interfaz (UI) visualmente clara junto al UI Designer?",
                "¬øCumpli√≥ con la cantidad de assets requeridos para la historia?",
                "¬øLas animaciones (si las hubo) son claras?",
                "¬øAdapt√≥ el arte seg√∫n las limitaciones t√©cnicas del programador?",
                "¬øSu trabajo visual mejora la experiencia del juego?"
            ],
            "Narrative Designer": [
                "¬øLa historia del RPG es 100% original y creativa?",
                "¬øLos di√°logos son coherentes y sin faltas de ortograf√≠a?",
                "¬øLos personajes tienen descripciones y personalidades claras?",
                "¬øEl guion del juego tiene un inicio, desarrollo y final l√≥gico?",
                "¬øEscribi√≥ el script para la presentaci√≥n del equipo?",
                "¬øColabor√≥ con el Artista para que los personajes visuales coincidan con la historia?",
                "¬øCre√≥ misiones u objetivos interesantes para el jugador?",
                "¬øEntreg√≥ los textos a tiempo para que el programador los insertara?",
                "¬øLa narrativa encaja bien con el g√©nero RPG?",
                "¬øAyud√≥ a definir el 'Lore' del mundo del juego?"
            ],
            "UI/UX Designer": [
                "¬øDise√±√≥ bocetos (wireframes) claros antes de programar?",
                "¬øLos men√∫s y botones son f√°ciles de entender para el usuario?",
                "¬øLa navegaci√≥n por el juego es intuitiva?",
                "¬øColabor√≥ estrechamente con el Art Director para el estilo visual?",
                "¬øAyud√≥ al programador a ubicar los elementos en la pantalla?",
                "¬øPens√≥ en la experiencia del usuario (que no sea frustrante)?",
                "¬øDise√±√≥ el flujo de pantallas (Inicio -> Juego -> Game Over)?",
                "¬øMostr√≥ empat√≠a hacia c√≥mo el jugador interact√∫a con el juego?",
                "¬øSus dise√±os facilitaron el uso de la aplicaci√≥n?",
                "¬øAport√≥ ideas para mejorar la jugabilidad?"
            ],
            "Marketing Director": [
                "¬øEnfoc√≥ sus esfuerzos en la calidad de la presentaci√≥n final?",
                "¬øAyud√≥ a vender la idea del juego de manera atractiva?",
                "¬øCre√≥ materiales promocionales o visuales para el pitch?",
                "¬øApoy√≥ al CEO en la estructura del discurso?",
                "¬øIdentific√≥ los puntos fuertes del juego para destacarlos?",
                "¬øAnaliz√≥ si el juego es atractivo para el p√∫blico objetivo?",
                "¬øAyud√≥ a ensayar la presentaci√≥n con el equipo?",
                "¬øMantuvo una actitud proactiva aunque no programara/dise√±ara?",
                "¬øComunic√≥ claramente de qu√© trata el juego?",
                "¬øColabor√≥ con el equipo en tareas generales cuando fue necesario?"
            ]
        };

        // INICIALIZACI√ìN
        window.onload = function () {
            const select = document.getElementById('companySelect');
            database.forEach((team, index) => {
                let opt = document.createElement('option');
                opt.value = index;
                opt.innerHTML = `${team.company} - ${team.game}`;
                select.appendChild(opt);
            });
        };

        function loadMembers() {
            const companyIdx = document.getElementById('companySelect').value;
            if (companyIdx === "") return;

            currentCompany = database[companyIdx];
            const userSelect = document.getElementById('userSelect');
            userSelect.innerHTML = '<option value="">-- Seleccionar tu nombre --</option>';

            currentCompany.members.forEach((member, index) => {
                let opt = document.createElement('option');
                opt.value = index;
                opt.innerHTML = `${member.name} (${member.role})`;
                userSelect.appendChild(opt);
            });

            document.getElementById('step-identity').classList.remove('hidden');
            document.getElementById('step-company').classList.add('hidden');
        }

        function detectUserRole() {
            const userIdx = document.getElementById('userSelect').value;
            if (userIdx === "") return;

            currentUser = currentCompany.members[userIdx];
            document.getElementById('myRoleDisplay').innerText = `‚ú® Tu rol: ${currentUser.role} ‚ú®`;
            document.getElementById('action-buttons').classList.remove('hidden');
        }

        function startSelfEval() {
            targetUser = currentUser;
            evalType = "auto";
            generateForm(selfQuestions, `üõ°Ô∏è Auto-Evaluaci√≥n: ${currentUser.name}`);
        }

        function showTeammates() {
            const peerSelect = document.getElementById('peerSelect');
            peerSelect.innerHTML = '<option value="">-- Seleccionar compa√±ero --</option>';

            currentCompany.members.forEach((member) => {
                if (member.name !== currentUser.name) {
                    let opt = document.createElement('option');
                    opt.value = member.name;
                    opt.innerHTML = `${member.name} (${member.role})`;
                    peerSelect.appendChild(opt);
                }
            });

            document.getElementById('step-identity').classList.add('hidden');
            document.getElementById('step-peer-select').classList.remove('hidden');
        }

        function startPeerEval() {
            const targetName = document.getElementById('peerSelect').value;
            if (targetName === "") {
                alert("‚ö†Ô∏è Por favor selecciona un compa√±ero");
                return;
            }

            targetUser = currentCompany.members.find(m => m.name === targetName);
            evalType = "peer";

            let questions = roleQuestions[targetUser.role];
            if (!questions) questions = selfQuestions;

            generateForm(questions, `‚öîÔ∏è Evaluando a: ${targetUser.name}`);
        }

        function generateForm(questionsList, title) {
            document.getElementById('step-peer-select').classList.add('hidden');
            document.getElementById('step-identity').classList.add('hidden');
            document.getElementById('step-form').classList.remove('hidden');

            document.getElementById('formTitle').innerText = title;
            document.getElementById('targetName').innerText = `üìå ${targetUser.role}`;

            const container = document.getElementById('questionsContainer');
            container.innerHTML = "";

            questionsList.forEach((q, i) => {
                let div = document.createElement('div');
                div.className = 'question-card';
                div.innerHTML = `
                <label>${i + 1}. ${q}</label>
                <select class="score-input score-select">
                    <option value="10" selected>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excelente (10)</option>
                    <option value="9">‚≠ê‚≠ê‚≠ê‚≠ê Muy Bien (9)</option>
                    <option value="8">‚≠ê‚≠ê‚≠ê Bien (8)</option>
                    <option value="7">‚≠ê‚≠ê Regular (7)</option>
                    <option value="6">‚≠ê Suficiente (6)</option>
                    <option value="5">Insuficiente (5)</option>
                    <option value="0">‚ùå Nulo (0)</option>
                </select>
            `;
                container.appendChild(div);
            });
        }

        function submitEvaluation() {
            const inputs = document.querySelectorAll('.score-input');
            let total = 0;
            let questionCount = inputs.length;

            // Calcular el total sumando todos los valores
            inputs.forEach(input => {
                const value = parseInt(input.value) || 0;
                total += value;
            });

            let finalScore = total;

            // Validaci√≥n: verificar que el puntaje sea razonable
            console.log(`Total questions: ${questionCount}, Total score: ${finalScore}`);

            // Confirmaci√≥n mejorada
            const confirmMsg = `üìä RESUMEN DE EVALUACI√ìN\n\n` +
                `Evaluando a: ${targetUser.name}\n` +
                `Rol: ${targetUser.role}\n` +
                `Preguntas respondidas: ${questionCount}\n` +
                `Puntaje total: ${finalScore}/100\n\n` +
                `¬øDeseas enviar esta evaluaci√≥n?`;

            if (!confirm(confirmMsg)) {
                // Usuario cancel√≥ - no hacer nada
                console.log("Usuario cancel√≥ el env√≠o");
                return;
            }

            // Mostrar pantalla de carga
            document.getElementById('step-form').classList.add('hidden');
            document.getElementById('step-loading').classList.remove('hidden');

            let studentName = targetUser.name;
            const url = `${SCRIPT_URL}?alumno=${encodeURIComponent(studentName)}&tipo=${evalType}&puntaje=${finalScore}`;

            // Log para debugging
            console.log("=== ENVIANDO EVALUACI√ìN ===");
            console.log("URL:", url);
            console.log("Alumno:", studentName);
            console.log("Tipo:", evalType);
            console.log("Puntaje:", finalScore);
            console.log("========================");

            // Usar fetch con configuraci√≥n mejorada
            fetch(url, {
                method: "GET",  // Cambiado a GET porque los par√°metros est√°n en la URL
                redirect: 'follow'
            })
                .then(response => {
                    console.log("Response status:", response.status);
                    console.log("Response OK:", response.ok);
                    return response.text();  // Primero obtener como texto para ver qu√© llega
                })
                .then(text => {
                    console.log("Response text:", text);
                    try {
                        const data = JSON.parse(text);
                        console.log("Parsed data:", data);

                        if (data.result === "success") {
                            alert("‚úÖ Evaluaci√≥n guardada correctamente en Google Sheets!");
                            resetApp();
                        } else {
                            alert("‚ùå Error al guardar: " + (data.error || "Desconocido"));
                            console.error("Error data:", data);
                            document.getElementById('step-loading').classList.add('hidden');
                            document.getElementById('step-form').classList.remove('hidden');
                        }
                    } catch (e) {
                        console.error("Error parsing JSON:", e);
                        console.error("Raw response:", text);
                        alert("‚ùå Error: La respuesta del servidor no es v√°lida. Revisa la consola (F12) para m√°s detalles.");
                        document.getElementById('step-loading').classList.add('hidden');
                        document.getElementById('step-form').classList.remove('hidden');
                    }
                })
                .catch(error => {
                    console.error("Fetch error:", error);
                    alert("‚ùå Error de conexi√≥n: " + error.message + "\n\nVerifica:\n1. Tu conexi√≥n a internet\n2. Que el Apps Script est√© deployed como 'Web app'\n3. Que el permiso sea 'Anyone'\n\nRevisa la consola (F12) para m√°s detalles.");
                    document.getElementById('step-loading').classList.add('hidden');
                    document.getElementById('step-form').classList.remove('hidden');
                });
        }

        function resetApp() {
            location.reload();
        }

    </script>

</body>

</html>